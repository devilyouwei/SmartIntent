const { Vulnerability } = require('./DB')
const T = Vulnerability

async function count() {
    return await T.count()
}

async function maxId() {
    return await T.max('Id')
}

async function findOneByPk(id, attributes) {
    const options = {}
    if (attributes) options.attributes = attributes
    return await T.findByPk(id, options)
}

async function findOneByContractId(contractId, attributes) {
    const options = {}
    if (attributes) options.attributes = attributes
    return await T.findOne({ where: { ContractId: contractId }, attributes })
}

async function insert(data) {
    const row = await T.create(data)
    console.log(row.Id, row.Vulnerability)
    return row
}

async function upsert(data) {
    const row = await T.upsert(data)
    console.log('Upsert Vul', row[0].Id)
    return row
}

async function update(data, id) {
    const row = await T.update(data, { where: { Id: id } })
    console.log('Update Vul', id)
    return row
}

if (process.argv[1].includes('db/vulnerability')) {
    if (process.argv[2] == 'count') count().then(r => console.log(r))
    if (process.argv[2] == 'max') maxId().then(r => console.log(r))
    if (process.argv[2] == 'get') findOneByPk(parseInt(process.argv[3])).then(r => console.log(r.dataValues))
}

module.exports = { findOneByPk, count, maxId, insert, upsert, update, T, findOneByContractId }
